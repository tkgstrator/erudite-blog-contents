name: Extract Frontmatter from Recent Posts
on:
  push:
    branches:
      - master
      - main
  workflow_call: # 他のワークフローから呼び出し可能にする
    inputs:
      commit_count:
        description: Number of recent commits to analyze for frontmatter
        required: false
        default: 1
        type: number 
    outputs:
      frontmatters:
        description: The list of frontmatter extracted from recent commits
        value: ${{ jobs.frontmatter.outputs.frontmatters }}
jobs:
  frontmatter:
    runs-on: ubuntu-24.04
    outputs:
      frontmatters: ${{ steps.extract.outputs.frontmatters }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - name: Install dependencies
        run: |
          bun add gray-matter --no-save
      - name: Extract frontmatter from recent commits
        id: extract
        run: |
          frontmatters=$(bun run scripts/extract-frontmatter.ts)
          echo "frontmatters<<EOF" >> $GITHUB_OUTPUT
          echo "$frontmatters" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT