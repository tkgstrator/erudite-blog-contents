---
title: 久しぶりに困る
date: 2025-04-15
description: Cloudflare R2に定期的にPostgreSQLのダンプをバックアップする仕組み、やっぱりほしいと思ってしまいました
tags: [Cloudflare, Docker, R2]
authors: ['tkgstrator']
---

## Cloudflare R2

Cloudflare R2はS3と互換性があり、バックアップも容易なのですがちょっとパラメータが違うためにそっくりそのままS3向けのDockerイメージが使えなかったりします。

定期的にデータベースの中身をバックアップする仕組みは、以前運用していた別サービスでも動かしていたのですが、そのときはR2ではなくLinodeのObject Storageを利用していました。

どちらもS3互換でほぼほぼ使い勝手は同じだったのですが、当時はPostgreSQL 16に対応していなかったりしたので、今回ちょっとだけコードを変えて17にも対応させました。とはいえ、コード自体がゴミなことには変わりがなく、全部シェルスクリプトで書かれていて読みにくいので、この際一気に直してしまおうと思います。

このCMSサーバーもオンプレなので、万が一データが飛んでしまうと全部の記事が消えてしまうので、その対策です。
